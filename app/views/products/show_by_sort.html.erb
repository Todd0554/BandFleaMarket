<% if user_signed_in? %>
<%= render 'shared/cart' %>
<% end %>
<table>
  <thead>
    <tr>
      <th>Picture</th>
      <th>Title</th>
      <th>Description</th>
      <th>Seller</th>
      <th>Sold</th>
      <th>Price</th>
      <th>Category</th>
      <th>Sort</th>
      <th></th>

    </tr>
  </thead>

  <tbody>
    <% @find_products_per_page.each do |product| %>

    <tr>
      <td style="text-align:center;"><%= link_to image_tag(product.picture, height: "150"), product %>
        <br></td>
      <td><%= link_to product.title, product %></td>
      <td><%= product.description %></td>
      <td><%= product.user.username %></td>
      <% if product.sold == false %>
      <td>Not yet</td>
      <% else %>
      <td>Sold</td>
      <% end %>
      <td><%= product.price %></td>
      <td><%= product.category.category %></td>
      <td><%= product.sort.sort %></td>
<td>
        <% if !user_signed_in? %>
        <%= link_to "Sign in to buy", new_user_session_path %>
        <% end %>
        <% if user_signed_in? %>
        <% already_add_to_cart = CartProduct.find_by(cart_id: @current_cart.id, product_id: product.id) %>
        <% if already_add_to_cart == nil %>
        <% if product.sold == true %>
        Already Sold
        <% else %>
        <div class="page-wrapper">
          <%= button_to cart_products_path(:product_id => product.id), id:"addtocart" do %>
          <%= "Add to cart" %>
          <span class="cart-item"></span>
          <% end %>
        </div>
        <% end %>
        <% else %>
        Already Added To Cart
        <% end %>
        <% end %>
      </td>
    </tr>

    <% end %>
  </tbody>
</table>

<br>
<% if @page > 0 %>
<%= link_to "Previous Page", products_path(page: @page - 1) %>
<% end %>
<% if @page < @find_products_by_sort.length / 5  %>
<%= link_to "Next Page", products_path(page: @page + 1) %>
<% end %>