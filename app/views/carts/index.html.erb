<% if @cartproducts.find_by(cart_id: @current_cart) == nil %>
<p>Your cart is empty.</p>
<%= link_to "Click Me and let's go shopping in BandFleaMarket", products_path, style:"color:#32ffff" %>

<% else %>


<table>
  <thead>
    <tr>
      <th style="text-align:center;">Picture</th>
      <th style="text-align:center;">Title</th>
      <th style="text-align:center;">User</th>
      <th style="text-align:center;">Price</th>
      <th style="text-align:center;">Category</th>
      <th style="text-align:center;">Sort</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
<% total_price = 0 %>
<% @cartproducts.each do |cp| %>
   
<% if Product.find_by(id: cp.product_id).sold == true %>
<% cp.delete %>
<% else %>
<% added_product = Product.find_by(id: cp.product_id) %>
    
    <tr>
      <td style="text-align:center;"><%= link_to image_tag(added_product.picture, height: "150"), added_product %>
      </td>
      <td style="text-align:center;"><%= link_to added_product.title, added_product %></td>
      <td style="text-align:center;"><%= added_product.user.username %></td>
      <td style="text-align:center;"><%= added_product.price %></td>
      <td style="text-align:center;"><%= added_product.category.category %></td>
      <td style="text-align:center;"><%= added_product.sort.sort %></td>
      <td><%= link_to "Remove Product", remove_product_from_cart_path(cp), method: :delete %></td>
    </tr>
    <% total_price += added_product.price %>
  <% end %>
  
<% end %>
  </tbody>
</table>

<br>
<%= "Total cost: $#{total_price}" %>
<%= button_to "Pay Together", orders_path, style:"color:#32CCCC" %>

<% end %>